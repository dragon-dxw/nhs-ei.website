# Application Structure

TOC

1. [Files & Folders](#ff)
2. [Wagtail App Guide](#wag)
3. [Importer Guide](#ig)
4. [Deployment Guide](#dg)

# [Files and Folders](#ff)

```
project
└───cms
│   │   urls.py (url configuration)
│   │   wsgi.py (server config)
│   │
│   └───[module name] e.g. atlascasestudies
│       └───migrations
│       │   ... wagtail auto generated
│       │
│       └───templates
│       │   ... html templates related to this module
│       │
│       └───templatetags
│       │   ... functions that can be used from templates
│       │
│       └───settings
│       │   ... config files for development/production etc
│       └───static
│       │   ... compiled static files
│       └───templates
│       │   ... site wide inherited templates in here, that don't relate to a specific module
│       admin.py (django admin config not used in Wagtail (=> wagtail_hooks.py)
│       apps.py (module config, auto generated)
│       models.py (models used in the module)
│       tests.py (tests for the module)
│       views.py (views for the module, although wagtail Page model generally replaces this)
│       wagtail_hooks.py (wagtail admin configuration)
│
│
└───importer
│   └───bin
│       │   ... file/s of commands
│   └───log
│   └───management
│   └───static
│   └───templates
│       └───migrations
│       │   ... auto generated by wagtail/django
│       │   
│       └───templates
│       │   ... not used on the frontend but can be used by developers
│       │   
│       admin.py (django admin config not used in Wagtail (=> wagtail_hooks.py)
│       apps.py (module config, auto generated)
│       ancestry.py (utility classes for importer)
│       documents_list_builder.py (function that are run at import stages)
│       import_*.py (django management commands that perform importing from scrapy API)
│       import_cls.py (a helper class used by import_*.py scripts)
│       models.py (unused)
│       *.ipynb (not required, used for experimentation, they are ipython notebook files)
│       richtextbuilder.py (used when importing to change json/fields into Wagtail streamfields dictionary objects)
│       test.py (not implemented yet)
│       url.py (module specific url config)
│       views.py (module specific views, only used as a developer reference)
│       wagtail_hook.py (no longer used)
│
└───packages
│   ... frontend assets (https://github.com/nhsuk/nhsuk-frontend)
│
README.md
requirements.dev
requirements.importer.txt
requirements.txt
manage.py
```
--- 
# [Wagtail App Guide](#wag)

The folder and files example of atlas_case_studies above is generally repeated across all apps that have frontend views. All apps have similar code/layout and function in a similar way.

`Management Commands` [Official Docs](https://docs.djangoproject.com/en/3.1/howto/custom-management-commands/) 

- Generally there is one management command for each app that deals with deleting all the records from it's model/s but they are not found in the app modules but in the importer module [Importer Guide](#ig)

`admin.py` [Official Docs](https://docs.djangoproject.com/en/3.1/ref/contrib/admin/)
- Is used to configure django-admin for each app. [Official Docs](https://docs.djangoproject.com/en/3.1/ref/contrib/admin/). Wagtail provides it's own admin via builtin class used or using wagtail_hooks.py for none Page models
    
`models.py` [Official Wagtail Docs](https://docs.wagtail.io/en/v2.10.2/topics/pages.html)
- Is where data models are defined, generally for Page models. Wagtail Page models also provide most template rendering methods

`wagtail_hooks.py` [Official Wagtail Docs](https://docs.wagtail.io/en/v2.10.2/reference/contrib/modeladmin/index.html)
- Wagtail hooks can be used in many different ways. The official docs link here has more detail

`views.py` While views are generally used in django to render html templates wagtail models provide that function built in for most use cases

---

# [Importer Guide](#ig)

### /bin

- Just some assets that are used for initial setup

### /log
- The import process logs errors here

### /management/commands
- Theres a lot of individual commands here. There are just two commands that are run from the command line. `python manage.py delete_all` and `python manage.py runimport`. These two commands in turn call the other commands in this folder. The other commands can be run separately during development.

---
# [Deployment Guide](#dg)

While the app can be developed using a virtual env or docker-compose, deploy to production needs  Docker. The github repo runs github actions to deploy the code to the Azure platform.

See [github actions] in the repo (https://github.com/rkhleics/nhs-ei.website/actions) for more information